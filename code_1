from fpdf import FPDF
from PyPDF2 import PdfReader, PdfWriter
import sys
import os

class TXTtoPDF(FPDF):
    def __init__(self):
        super().__init__()
        self.set_auto_page_break(auto=True, margin=15)
        self.add_page()
        self.set_font("Courier", size=11)

    def add_txt_content(self, txt_path):
        with open(txt_path, 'r') as file:
            for line in file:
                self.cell(0, 6, txt=line.rstrip(), ln=True)

def upgrade_pdf_version(input_pdf, output_pdf, version="1.7"):
    reader = PdfReader(input_pdf)
    writer = PdfWriter()

    for page in reader.pages:
        writer.add_page(page)

    writer.pdf_header = f"%PDF-{version}"
    with open(output_pdf, "wb") as f:
        writer.write(f)

def convert_txt_to_pdf17(txt_file):
    base_name = os.path.splitext(txt_file)[0]
    temp_pdf = base_name + "_temp.pdf"
    final_pdf = base_name + "_v1.7.pdf"

    pdf = TXTtoPDF()
    pdf.add_txt_content(txt_file)
    pdf.output(temp_pdf)

    upgrade_pdf_version(temp_pdf, final_pdf)
    os.remove(temp_pdf)  # cleanup

    print(f"âœ… PDF created: {final_pdf} (Version 1.7)")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python txt2pdf.py <file.txt>")
    else:
        convert_txt_to_pdf17(sys.argv[1])
